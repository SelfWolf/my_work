# 所有任务梳理

## 知识库相关任务

### knowledge_base_data

* 作用：从埋点日志中，统计知识库使用情况，包括query、user、key、title等信息
* 数据来源：ods.track_log_with_event
* 数据写入：bt_inst.knowledge_base_data
* 调用方：客服统计面板数据来源
* 对接人：蒋亭

### knowledge_base_data_1

* *knowledge_base_data* 任务的升级版，新增了几个统计字段
* 数据来源：同上
* 数据写入：bt_inst.knowledge_base_data_2
* 调用方：客服统计面板数据来源
* 对接人：蒋亭

## 日常任务

### shop_species_process_data

* 作用：通过商家名称，对商家进行分类，例如福记龙虾，餐品分类龙虾
* 数据来源：da.ads_shop_merge_df
* 数据写入：bt_inst.shop_species_process_data
* 调用方：未知
* 对接人：未知

## 安全抽查任务

对接人：冯小奔

### sc_down_safe_check_pics_60min

* 作用：图片下载任务，获取安全抽查图片
* 数据来源：workorder，实时数据库
* 数据写入：root@10.11.6.63 -p 10000 /data1/warehouse/picture/equipment_check
* 调用方：[sc_rider_safe_check_task_60min](#sc_rider_safe_check_task_60min)
* 执行文件：/home/project/bigdata-image/equipment_check/production/down_safe_check_pics.py

### <span id='sc_rider_safe_check_task_60min'>sc_rider_safe_check_task_60min</span>

* 作用：安全检测任务，对下载的图片，利用模型进行图片识别
* 数据来源：root@10.11.6.63 -p 10000 /data1/warehouse/picture/equipment_check
* 数据写入：root@10.11.6.63 -p 10000 /home/output/body
* 模型文件：root@10.11.6.63 -p 10000 /home/project/rider_box_detector2/output/safe_vgg16_1223/voc_2007_trainval/default/
* 调用方：[sc_upload_safe_csv_hdfs_sh_60min](#sc_upload_safe_csv_hdfs_sh_60min)
* 执行文件：/home/project/rider_box_detector2/tools/run_safe_check.py

### <span id='sc_upload_safe_csv_hdfs_sh_60min'>sc_upload_safe_csv_hdfs_sh_60min</span>

* 作用：检测结果文件上传到hdfs
* 数据来源：/data1/airflow/output/body/$date1/safe_$date0.csv
* 数据写入：/tmp/airflow/rider_equipment_data/$date1/
* 调用方：[sc_rider_safe_check_real_60min](#sc_rider_safe_check_real_60min)
* 执行文件：airflow@10.11.6.63 /home/ops/project/bigdata-image/equipment_check/production/pro_shell/upload_safe_check_csv_hdfs.sh

### <span id='sc_rider_safe_check_real_60min'>sc_rider_safe_check_real_60min</span>

* 作用：利用大数据技术把结果进行分析汇总后存入到数仓并写入到mysql
* 数据来源：/tmp/airflow/rider_equipment_data/%(slim_date)s/safe_%(file_name_hh)s.csv
* 数据写入：workorderdb

### sc_monitor_safe_check_10

* 作用：每天10点，检测前一天装备抽查情况，统计模型检测占比情况
* 数据来源：da.dwb_workorder_base_df、bd.ads_rider_safe_check_result
* 数据写入：bd.ads_rider_safe_check_summary_daily、钉钉群

### sc_safe_equipment_forecast

* 作用：待定
* 数据来源：workorder_table、bd.ads_other_equipment_check_forecast_df_safe、bd.ads_rider_safe_check、da.dwb_workorder_base_df
* 数据写入：bd.ads_other_equipment_check_evaluate_df_safe、bd.ads_other_equipment_train_df_safe

## 装备抽查

对接人：陆超

### sc_down_check_pics_60min

* 作用：装备抽查照片图片下载任务
* 服务器：root@10.11.6.63 -p 10000
* 数据来源：workorderdb.workorder
* 数据写入：/data1/warehouse/picture/equipment_check
* 执行文件：/home/project/bigdata-image/equipment_check/production/down_check_pics.py

### sc_down_idc_pics_60min

* 作用：手持身份证照片下载任务
* 服务器：root@10.11.6.63 -p 10000
* 数据来源：riderextradb.rider_pictures
* 数据写入：/data1/warehouse/picture/equipment_check
* 对比数据：/data1/warehouse/picture/hand_hold_idc/ret
* 执行文件：/home/project/bigdata-image/equipment_check/production/down_idc_pics.py

### sc_face_distance_new_60min

* 作用：人脸比对任务
* 服务器：root@10.11.6.63 -p 10000
* 数据来源：/data1/warehouse/picture/equipment_check
* 对比数据：/data1/warehouse/picture/hand_hold_idc/ret
* 数据写入：/home/output/face
* 执行文件：/home/project/face-detect/rider_face_compare.py
* 模型文件：/home/project/rider_box_detector2/output/face_detect_model/

### sc_equipment_check_task_60min

* 作用：目标装备检测任务
* 服务器：root@10.11.6.63 -p 10000
* 数据来源：/data1/warehouse/picture/equipment_check
* face数据：/home/output/face/$1/face_$pt_hour.csv
* 数据写入：/home/output/body
* 执行文件：/home/project/rider_box_detector2/tools/run.py
* 模型文件：/home/project/rider_box_detector2/output/vgg16_20190702/voc_2007_trainval/default/

### sc_upload_csv_hdfs_sh_60min

* 作用：检测结果文件上传到hdfs
* 服务器：airflow@10.11.6.63
* 执行文件：/home/ops/project/bigdata-image/equipment_check/upload_csv_hdfs.sh $pt_hour
* 数据来源：/data1/airflow/output/body/$date1/body/face_$date0.csv
* 数据写入：/tmp/airflow/rider_equipment_data/

### sc_rider_equipment_check_real_60min

* 作用：利用大数据技术把结果进行分析汇总后存入到数仓并写入到mysql
* 依赖任务：sc_upload_csv_hdfs_sh_60min、sc_rider_safe_check_real_60min
* 数据来源：
* 数据写入：workorder_equip_check

## 通话记录OCR任务

### sc_down_call_record_pics_8h

* 作用：图片下载任务，下载通话记录截图
* 服务器：root@10.11.6.63 -p 10000
* 执行文件：/home/project/bigdata-image/equipment_check/production/down_call_records_pics.py
* 数据来源：workorderdb.workorder_guest_offline_check、ods.rider_standard_equipment_check_action_record
* 数据写入：/data1/warehouse/picture/call_history

### sc_process_call_records_8clock

* 作用：通话记录检测任务
* 服务器：root@10.11.6.63 -p 10000
* 数据来源：/data1/warehouse/picture/call_history
* 数据写入：/home/output/call
* 执行文件：/home/project/bigdata-image/equipment_check/production/check_task_serial_call_records.py、/home/project/ocr/call-history/run.py

### sc_upload_call_records_to_hdfs_8clock

* 作用：检测结果文件上传到hdfs
* 服务器：airflow@10.11.6.63
* 数据来源：/data1/airflow/output/call/$date1/call_history_$date0.csv
* 数据写入：/tmp/airflow/rider_equipment_data/$date1/
* 执行文件：/home/ops/project/bigdata-image/equipment_check/production/pro_shell/upload_call_csv_hdfs.sh $pt
* 依赖任务：sc_process_call_records_8clock、run_on_8_clock_ywfz

### sc_bd_rider_call_record_reco_8clock

* 作用：利用大数据技术把结果进行分析汇总后存入到数仓并写入到mysql
* 数据来源：
* 数据写入：bd.ads_rider_call_record_reco
* 依赖任务：run_on_8_clock_ywfz、sc_upload_call_records_to_hdfs_8clock

## 面单识别

对接人：包单霖

### sc_down_package_receipt_pics_sh_day

* 作用：下载图片

### sc_process_package_receipt_sh_day  面单号识别/签字检测

### sc_upload_package_receipt_to_hdfs_sh_day 上传图片到hdfs

### sc_bd_ads_rider_package_receipt_check_day 数仓留档后，数据写入到mysql